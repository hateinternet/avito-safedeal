{"version":3,"sources":["components/error-indicator/error.svg","service.js","components/spinner/index.js","components/spinner/spinner.js","components/error-indicator/index.js","components/error-indicator/error-indicator.js","components/input/index.js","components/input/input.js","utils/generateId.js","utils/transformDate.js","components/gallery-modal/index.js","components/gallery-modal/gallery-modal.js","components/gallery/index.js","components/gallery/gallery.js","components/app/index.js","components/app/app.js","index.js"],"names":["module","exports","GalleryService","_apiBase","url","fetch","this","res","ok","Error","status","json","body","getResource","id","comment","method","headers","JSON","stringify","Promise","resolve","Spinner","className","ErrorIndicator","src","image","alt","href","Input","name","value","onChange","placeholder","errorText","isValid","cls","cn","length","placeholderText","type","Math","random","toString","substr","timestamp","Date","toLocaleDateString","GalleryModal","galleryService","state","loading","error","comments","text","nameIsValid","textIsValid","submitForm","evt","preventDefault","validateForm","postComment","props","modalIdx","then","newComment","generateId","date","now","setState","concat","changeInput","target","renderComments","map","key","transformDate","renderModalContent","closeModal","onClick","onSubmit","getImage","catch","nameIsEmpty","textIsEmpty","modalContent","React","Component","Gallery","images","modalOpened","openModal","document","classList","add","remove","renderImages","renderModal","getAllImages","modal","App","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.29be2cfa.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/error.887a5f02.svg\";","export default class GalleryService {\n  _apiBase = 'https://boiling-refuge-66454.herokuapp.com';\n\n  async getResource(url) {\n    const res = await fetch(`${this._apiBase}${url}`);\n\n    if (!res.ok) {\n      throw new Error(`Could not fetch ${url}, recieved ${res.status}`);\n    }\n\n    const body = await res.json();\n    return body;\n  }\n\n  async getAllImages() {\n    const res = await this.getResource('/images');\n    return await res;\n  }\n\n  async getImage(id) {\n    const res = await this.getResource(`/images/${id}`);\n    return await res;\n  }\n\n  async postComment(id, comment) {\n    const res = await fetch(`${this._apiBase}/images/${id}/comments`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json;charset=utf-8',\n      },\n      body: JSON.stringify(comment),\n    });\n\n    if (res.status !== 204) {\n      throw new Error(`Could not fetch, recieved ${res.status}`);\n    }\n\n    return Promise.resolve();\n  }\n}\n","import Spinner from './spinner';\n\nexport default Spinner;\n","import React from 'react';\n\nimport './spinner.css';\n\nconst Spinner = () => {\n  return (\n    <div className=\"spinner\">\n      <div className=\"spinner__inner\" />\n    </div>\n  );\n};\n\nexport default Spinner;\n","import ErrorIndicator from './error-indicator';\n\nexport default ErrorIndicator;\n","import React from 'react';\n\nimport image from './error.svg';\nimport './error-indicator.css';\n\nconst ErrorIndicator = () => {\n  return (\n    <div className=\"error\">\n      <img className=\"error__image\" src={image} alt=\"error\" />\n      <span className=\"error__text\">something has gone terribly wrong</span>\n      <a className=\"error__link\" href=\"/\">try starting over</a>\n    </div>\n  );\n};\n\nexport default ErrorIndicator;\n","import Input from './input';\n\nexport default Input;\n","import React from 'react';\nimport cn from 'classnames';\n\nimport './input.css';\n\nconst Input = ({name, value, onChange, placeholder, errorText = 'Заполните поле', isValid = true }) => {\n  const cls = cn({\n    'input': true,\n    'input_filled': value.length > 0,\n    'input_error': !isValid,\n  });\n  const placeholderText = isValid ? placeholder : errorText;\n\n  return (\n    <div className={cls}>\n      <input className=\"input__field\" type=\"text\" name={name} value={value} onChange={onChange} />\n      <div className=\"input__placeholder\">{placeholderText}</div>\n    </div>\n  );\n};\n\nexport default Input;\n","export default () => Math.random().toString(32).substr(2, 12);\n","export default (timestamp) => {\n  const date = new Date(timestamp);\n  return date.toLocaleDateString();\n};\n","import GalleryModal from './gallery-modal';\n\nexport default GalleryModal;\n","import React from 'react';\n\nimport GalleryService from '../../service';\nimport Spinner from '../spinner';\nimport ErrorIndicator from '../error-indicator';\nimport Input from '../input';\nimport { generateId, transformDate } from '../../utils';\nimport './gallery-modal.css';\n\nexport default class GalleryModal extends React.Component {\n  galleryService = new GalleryService();\n\n  state = {\n    loading: true,\n    error: false,\n    url: '',\n    comments: [],\n    name: '',\n    text: '',\n    nameIsValid: true,\n    textIsValid: true,\n  };\n\n  componentDidMount() {\n    this.galleryService\n      .getImage(this.props.modalIdx)\n      .then(({ url, comments }) => {\n        this.setState({\n          url,\n          comments,\n          loading: false,\n        });\n      })\n      .catch(() => {\n        this.setState({\n          error: true,\n          loading: false,\n        });\n      });\n  }\n\n  validateForm() {\n    const { name, text } = this.state;\n    const nameIsEmpty = name.length === 0;\n    const textIsEmpty = text.length === 0;\n\n    this.setState({\n      nameIsValid: !nameIsEmpty,\n      textIsValid: !textIsEmpty,\n    });\n\n    if (nameIsEmpty || textIsEmpty) {\n      return false;\n    }\n\n    return true;\n  }\n\n  submitForm = (evt) => {\n    evt.preventDefault();\n\n    const formIsValid = this.validateForm();\n    if (!formIsValid) {\n      return ;\n    }\n\n    const { text, name } = this.state;\n    this.galleryService\n      .postComment(this.props.modalIdx, {name, comment: text})\n      .then(() => {\n        const { comments } = this.state;\n        const newComment = {\n          text,\n          id: generateId(),\n          date: Date.now(),\n        };\n\n        this.setState({\n          name: '',\n          text: '',\n          nameIsValid: true,\n          textIsValid: true,\n          comments: comments.concat(newComment),\n        });\n      });\n  };\n\n  changeInput = (evt) => {\n    this.setState({ [evt.target.name]: evt.target.value });\n  };\n\n  renderComments = () => {\n    const { comments } = this.state;\n\n    if (comments.length === 0) {\n      return (\n        <div className=\"gallery-modal__comments-dummy\">\n          Здесь пока никто не написал... :(\n          <br />\n          Оставьте первый комментарий!\n        </div>\n      );\n    }\n\n    const renderedComments = comments.map(comment => {\n      const { id, date, text } = comment;\n      return (\n        <div key={id} className=\"gallery-modal__comment\">\n          <time className=\"gallery-modal__comment-date\">{transformDate(date)}</time>\n          <p className=\"gallery-modal__comment-text\">{text}</p>\n        </div>\n      );\n    });\n\n    return renderedComments;\n  };\n\n  renderModalContent = () => {\n    if (this.state.loading) {\n      return <Spinner />;\n    }\n\n    if (this.state.error) {\n      return <ErrorIndicator />;\n    }\n\n    const { closeModal } = this.props;\n    const { url, name, text, nameIsValid, textIsValid } = this.state;\n    const comments = this.renderComments();\n\n    return (\n      <>\n        <button className=\"gallery-modal__close\" onClick={closeModal}/>\n        <div className=\"gallery-modal__image-container\">\n          <img className=\"gallery-modal__image\" src={url} alt=\"\" />\n        </div>\n        <div className=\"gallery-modal__comments\">{comments}</div>\n        <form className=\"gallery-modal__form\" onSubmit={this.submitForm}>\n          <div className=\"gallery-modal__input\">\n            <Input name=\"name\"\n              value={name}\n              onChange={this.changeInput}\n              placeholder=\"Ваше имя\"\n              errorText=\"Введите ваше имя\"\n              isValid={nameIsValid} />\n          </div>\n          <div className=\"gallery-modal__input\">\n            <Input name=\"text\"\n              value={text}\n              onChange={this.changeInput}\n              placeholder=\"Ваш комментарий\"\n              errorText=\"Введите комментарий\"\n              isValid={textIsValid} />\n          </div>\n          <button className=\"gallery-modal__button\">Оставить комментарий</button>\n        </form>\n      </>\n    );\n  };\n\n  render() {\n    const { closeModal } = this.props;\n    const modalContent = this.renderModalContent();\n\n    return (\n      <div className=\"gallery-modal\">\n        <div className=\"gallery-modal__paranja\" onClick={closeModal}/>\n        <div className=\"gallery-modal__content\">\n          { modalContent }\n        </div>\n      </div>\n    );\n  }\n}\n","import Gallery from './gallery';\n\nexport default Gallery;\n","import React from 'react';\n\nimport GalleryService from '../../service';\nimport Spinner from '../spinner';\nimport ErrorIndicator from '../error-indicator';\nimport GalleryModal from '../gallery-modal';\nimport './gallery.css';\n\nexport default class Gallery extends React.Component {\n  galleryService = new GalleryService();\n\n  state = {\n    loading: true,\n    error: false,\n    images: null,\n    modalOpened: false,\n    modalIdx: null,\n    name: '',\n    text: '',\n  };\n\n  componentDidMount() {\n    this.galleryService.getAllImages()\n      .then(images => {\n        this.setState({ loading: false, images });\n      })\n      .catch(() => {\n        this.setState({ loading: false, error: true });\n      });\n  }\n\n  openModal = (id) => {\n    document.body.classList.add('scroll-hidden');\n    this.setState({ modalOpened: true, modalIdx: id });\n  }\n\n  closeModal = () => {\n    document.body.classList.remove('scroll-hidden');\n    this.setState({ modalOpened: false, modalIdx: null });\n  }\n\n  renderImages = () => this.state.images.map(({ id, url }) => (\n    <div key={id} className=\"gallery-item\" onClick={() => this.openModal(id)}>\n      <img src={url} className=\"gallery-item__img\" alt=\"\" />\n    </div>\n  ));\n\n  renderModal = () => {\n    const { modalOpened, modalIdx } = this.state;\n\n    if (!modalOpened) {\n      return null;\n    }\n\n    return <GalleryModal modalIdx={modalIdx} closeModal={this.closeModal}/>;\n  }\n\n  render() {\n    if (this.state.loading) {\n      return <Spinner />;\n    }\n\n    if (this.state.error) {\n      return <ErrorIndicator />;\n    }\n\n    const images = this.renderImages();\n    const modal = this.renderModal();\n\n    return (\n      <div className=\"gallery\">\n        { images }\n        { modal }\n      </div>\n    );\n  }\n}\n","import App from './app';\n\nexport default App;\n","import React from 'react';\n\nimport Gallery from '../gallery';\nimport './app.css';\n\nexport default class App extends React.Component {\n\n  render() {\n    return (\n      <section className=\"app\">\n\n        <header className=\"app__header\">\n          <h1 className=\"app__title\">Test App</h1>\n        </header>\n\n        <div className=\"app__main\">\n          <Gallery />\n        </div>\n\n        <footer className=\"app__footer\">\n          <span className=\"app__copyright\">\n            &copy; 2018-2019\n          </span>\n        </footer>\n\n      </section>\n    );\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport './normalize.css';\nimport './style.css';\n\nimport App from './components/app';\n\nReactDOM.render(<App />, document.getElementById('root'));\n"],"sourceRoot":""}