{"version":3,"sources":["components/error-indicator/error.svg","service.js","components/spinner/index.js","components/spinner/spinner.js","components/error-indicator/index.js","components/error-indicator/error-indicator.js","components/input/index.js","components/input/input.js","utils/generateId.js","utils/transformDate.js","components/gallery-modal/index.js","components/gallery-modal/gallery-modal.js","components/gallery/index.js","components/gallery/gallery.js","components/app/index.js","components/app/app.js","index.js"],"names":["module","exports","GalleryService","_apiBase","url","fetch","this","res","ok","Error","status","json","body","getResource","id","comment","method","headers","JSON","stringify","Promise","resolve","Spinner","className","ErrorIndicator","src","image","alt","href","Input","name","value","onChange","placeholder","errorText","isValid","cls","cn","length","placeholderText","type","Math","random","toString","substr","timestamp","Date","toLocaleDateString","GalleryModal","galleryService","buttonRef","React","createRef","state","loading","error","comments","text","nameIsValid","textIsValid","submitBlocked","keyDownModal","key","props","closeModal","submitForm","evt","preventDefault","validateForm","setState","postComment","modalIdx","then","newComment","generateId","date","now","concat","current","blur","changeInput","target","renderComments","map","transformDate","renderModalContent","onSubmit","ref","onClick","getImage","catch","document","addEventListener","removeEventListener","nameIsEmpty","trim","textIsEmpty","modalContent","Component","Gallery","images","modalOpened","openModal","classList","add","remove","keyDownGallery","renderImages","onKeyDown","tabIndex","renderModal","getAllImages","modal","App","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.f90df2d8.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/error.887a5f02.svg\";","export default class GalleryService {\n  _apiBase = 'https://boiling-refuge-66454.herokuapp.com';\n\n  async getResource(url) {\n    const res = await fetch(`${this._apiBase}${url}`);\n\n    if (!res.ok) {\n      throw new Error(`Could not fetch ${url}, recieved ${res.status}`);\n    }\n\n    const body = await res.json();\n    return body;\n  }\n\n  async getAllImages() {\n    const res = await this.getResource('/images');\n    return await res;\n  }\n\n  async getImage(id) {\n    const res = await this.getResource(`/images/${id}`);\n    return await res;\n  }\n\n  async postComment(id, comment) {\n    const res = await fetch(`${this._apiBase}/images/${id}/comments`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json;charset=utf-8',\n      },\n      body: JSON.stringify(comment),\n    });\n\n    if (res.status !== 204) {\n      throw new Error(`Could not fetch, recieved ${res.status}`);\n    }\n\n    return Promise.resolve();\n  }\n}\n","import Spinner from './spinner';\n\nexport default Spinner;\n","import React from 'react';\n\nimport './spinner.css';\n\nconst Spinner = () => {\n  return (\n    <div className=\"spinner\">\n      <div className=\"spinner__inner\" />\n    </div>\n  );\n};\n\nexport default Spinner;\n","import ErrorIndicator from './error-indicator';\n\nexport default ErrorIndicator;\n","import React from 'react';\n\nimport image from './error.svg';\nimport './error-indicator.css';\n\nconst ErrorIndicator = () => {\n  return (\n    <div className=\"error\">\n      <img className=\"error__image\" src={image} alt=\"error\" />\n      <span className=\"error__text\">something has gone terribly wrong</span>\n      <a className=\"error__link\" href=\"/\">try starting over</a>\n    </div>\n  );\n};\n\nexport default ErrorIndicator;\n","import Input from './input';\n\nexport default Input;\n","import React from 'react';\nimport cn from 'classnames';\n\nimport './input.css';\n\nconst Input = ({name, value, onChange, placeholder, errorText = 'Заполните поле', isValid = true }) => {\n  const cls = cn({\n    'input': true,\n    'input_filled': value.length > 0,\n    'input_error': !isValid,\n  });\n  const placeholderText = isValid ? placeholder : errorText;\n\n  return (\n    <div className={cls}>\n      <input className=\"input__field\" type=\"text\" name={name} value={value} onChange={onChange}/>\n      <div className=\"input__placeholder\">{placeholderText}</div>\n    </div>\n  );\n};\n\nexport default Input;\n","export default () => Math.random().toString(32).substr(2, 12);\n","export default (timestamp) => {\n  const date = new Date(timestamp);\n  return date.toLocaleDateString();\n};\n","import GalleryModal from './gallery-modal';\n\nexport default GalleryModal;\n","import React from 'react';\nimport FocusLock from \"react-focus-lock\";\n\nimport GalleryService from '../../service';\nimport Spinner from '../spinner';\nimport ErrorIndicator from '../error-indicator';\nimport Input from '../input';\nimport { generateId, transformDate } from '../../utils';\nimport './gallery-modal.css';\n\nexport default class GalleryModal extends React.Component {\n  galleryService = new GalleryService();\n  buttonRef = React.createRef();\n\n  state = {\n    loading: true,\n    error: false,\n    url: '',\n    comments: [],\n    name: '',\n    text: '',\n    nameIsValid: true,\n    textIsValid: true,\n    submitBlocked: false,\n  };\n\n  componentDidMount() {\n    this.galleryService\n      .getImage(this.props.modalIdx)\n      .then(({ url, comments }) => {\n        this.setState({\n          url,\n          comments,\n          loading: false,\n        });\n      })\n      .catch(() => {\n        this.setState({\n          error: true,\n          loading: false,\n        });\n      });\n\n    // не нашел адекватного пути вешать обработку клавиши Escape :(\n    // если вешать onKeyDown на .gallery-modal - Escape не срабатывает, т.к. фокус уходит на body\n    // и приходится минимум 1 раз нажать tab для фокусировки внутри модалки\n    document.body.addEventListener('keydown', this.keyDownModal);\n  }\n\n  componentWillUnmount() {\n    document.body.removeEventListener('keydown', this.keyDownModal);\n  }\n\n  keyDownModal = ({ key }) => {\n    key === 'Escape' && this.props.closeModal();\n  };\n\n  validateForm() {\n    const { name, text } = this.state;\n    const nameIsEmpty = name.trim().length === 0;\n    const textIsEmpty = text.trim().length === 0;\n\n    this.setState({\n      nameIsValid: !nameIsEmpty,\n      textIsValid: !textIsEmpty,\n    });\n\n    if (nameIsEmpty || textIsEmpty) {\n      return false;\n    }\n\n    return true;\n  }\n\n  submitForm = (evt) => {\n    evt.preventDefault();\n\n    const formIsValid = this.validateForm();\n    if (!formIsValid) {\n      return ;\n    }\n\n    const { submitBlocked } = this.state;\n    if (submitBlocked) {\n      return ;\n    }\n\n    const { text, name } = this.state;\n    this.setState({ submitBlocked: true });\n    this.galleryService\n      .postComment(this.props.modalIdx, {name, comment: text})\n      .then(() => {\n        const { comments } = this.state;\n        const newComment = {\n          text,\n          id: generateId(),\n          date: Date.now(),\n        };\n\n        this.setState({\n          name: '',\n          text: '',\n          nameIsValid: true,\n          textIsValid: true,\n          comments: comments.concat(newComment),\n          submitBlocked: false,\n        });\n      });\n\n    this.buttonRef.current.blur();\n  };\n\n  changeInput = (evt) => {\n    this.setState({ [evt.target.name]: evt.target.value });\n  };\n\n  renderComments = () => {\n    const { comments } = this.state;\n\n    if (comments.length === 0) {\n      return (\n        <div className=\"gallery-modal__comments-dummy\">\n          Здесь пока никто не написал... :(\n          <br />\n          Оставьте первый комментарий!\n        </div>\n      );\n    }\n\n    const renderedComments = comments.map(comment => {\n      const { id, date, text } = comment;\n      return (\n        <div key={id} className=\"gallery-modal__comment\">\n          <time className=\"gallery-modal__comment-date\">{transformDate(date)}</time>\n          <p className=\"gallery-modal__comment-text\">{text}</p>\n        </div>\n      );\n    });\n\n    return renderedComments;\n  };\n\n  renderModalContent = () => {\n    if (this.state.loading) {\n      return <Spinner />;\n    }\n\n    if (this.state.error) {\n      return <ErrorIndicator />;\n    }\n\n    const { closeModal } = this.props;\n    const { url, name, text, nameIsValid, textIsValid } = this.state;\n    const comments = this.renderComments();\n\n    return (\n      <>\n        <div className=\"gallery-modal__image-container\">\n          <img className=\"gallery-modal__image\" src={url} alt=\"\" />\n        </div>\n        <div className=\"gallery-modal__comments\">{comments}</div>\n        <form className=\"gallery-modal__form\" onSubmit={this.submitForm}>\n          <div className=\"gallery-modal__input\">\n            <Input name=\"name\"\n              value={name}\n              onChange={this.changeInput}\n              placeholder=\"Ваше имя\"\n              errorText=\"Введите ваше имя\"\n              isValid={nameIsValid} />\n          </div>\n          <div className=\"gallery-modal__input\">\n            <Input name=\"text\"\n              value={text}\n              onChange={this.changeInput}\n              placeholder=\"Ваш комментарий\"\n              errorText=\"Введите комментарий\"\n              isValid={textIsValid} />\n          </div>\n          <button className=\"gallery-modal__button\" ref={this.buttonRef}>Оставить комментарий</button>\n        <button className=\"gallery-modal__close\" onClick={closeModal}/>\n        </form>\n      </>\n    );\n  };\n\n  render() {\n    const { closeModal } = this.props;\n    const modalContent = this.renderModalContent();\n\n    return (\n      <FocusLock>\n        <div className=\"gallery-modal\">\n          <div className=\"gallery-modal__paranja\" onClick={closeModal}/>\n          <div className=\"gallery-modal__content\">\n            { modalContent }\n          </div>\n        </div>\n      </FocusLock>\n    );\n  }\n}\n","import Gallery from './gallery';\n\nexport default Gallery;\n","import React from 'react';\n\nimport GalleryService from '../../service';\nimport Spinner from '../spinner';\nimport ErrorIndicator from '../error-indicator';\nimport GalleryModal from '../gallery-modal';\nimport './gallery.css';\n\nexport default class Gallery extends React.Component {\n\n  galleryService = new GalleryService();\n\n  state = {\n    loading: true,\n    error: false,\n    images: null,\n    modalOpened: false,\n    modalIdx: null,\n    name: '',\n    text: '',\n  };\n\n  componentDidMount() {\n    this.galleryService.getAllImages()\n      .then(images => {\n        this.setState({ loading: false, images });\n      })\n      .catch(() => {\n        this.setState({ loading: false, error: true });\n      });\n  }\n\n  openModal = (id) => {\n    document.body.classList.add('scroll-hidden');\n    this.setState({ modalOpened: true, modalIdx: id });\n  };\n\n  closeModal = () => {\n    document.body.classList.remove('scroll-hidden');\n    this.setState({ modalOpened: false, modalIdx: null });\n  };\n\n  keyDownGallery = (evt, id) => {\n    if (evt.key === 'Enter') {\n      this.openModal(id);\n      evt.target.blur();\n    }\n  };\n\n  renderImages = () => this.state.images.map(({ id, url }) => (\n    <div\n      key={id}\n      className=\"gallery-item\"\n      onClick={() => this.openModal(id)}\n      onKeyDown={(evt) => this.keyDownGallery(evt, id)}\n      tabIndex=\"0\">\n      <img src={url} className=\"gallery-item__img\" alt=\"\" />\n    </div>\n  ));\n\n  renderModal = () => {\n    const { modalOpened, modalIdx } = this.state;\n\n    if (!modalOpened) {\n      return null;\n    }\n\n    return <GalleryModal modalIdx={modalIdx} closeModal={this.closeModal}/>;\n  }\n\n  render() {\n    if (this.state.loading) {\n      return <Spinner />;\n    }\n\n    if (this.state.error) {\n      return <ErrorIndicator />;\n    }\n\n    const images = this.renderImages();\n    const modal = this.renderModal();\n\n    return (\n      <div className=\"gallery\">\n        { images }\n        { modal }\n      </div>\n    );\n  }\n}\n","import App from './app';\n\nexport default App;\n","import React from 'react';\n\nimport Gallery from '../gallery';\nimport './app.css';\n\nexport default class App extends React.Component {\n\n  render() {\n    return (\n      <section className=\"app\">\n\n        <header className=\"app__header\">\n          <h1 className=\"app__title\">Test App</h1>\n        </header>\n\n        <div className=\"app__main\">\n          <Gallery />\n        </div>\n\n        <footer className=\"app__footer\">\n          <span className=\"app__copyright\">\n            &copy; 2018-2019\n          </span>\n        </footer>\n\n      </section>\n    );\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport './normalize.css';\nimport './style.css';\n\nimport App from './components/app';\n\nReactDOM.render(<App />, document.getElementById('root'));\n"],"sourceRoot":""}